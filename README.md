## User API & Document Generator (Microservices)

Это полноценная микросервисная система для управления пользователями и асинхронной генерации документов.
Проект реализован в **монорепозитории** и использует событийно-ориентированную архитектуру (Producer-Consumer).

---

## Технологический стек

* **Язык:** Python 3.12
* **Фреймворк:** FastAPI
* **База данных:** ClickHouse (OLAP, асинхронные вставки, MergeTree)
* **Брокер сообщений:** Redis
* **Контейнеризация:** Docker & Docker Compose
* **Управление зависимостями:** Poetry
* **Тестирование:** Pytest
* **Линтинг:** Flake8
* **CI/CD:** GitHub Actions

---

## Архитектура

Система состоит из 4-х контейнеров, связанных через `docker-compose`:

1.  **`fastapi_app` (Порт 8000)** — Основной API (Producer).
    * Управляет пользователями (CRUD).
    * Принимает запросы на генерацию документов.
    * Отправляет задачи в Redis.
    * Логирует события в ClickHouse.
2.  **`generator_service` (Порт 8001)** — Воркер и Админка (Consumer).
    * Слушает очередь Redis.
    * Имитирует тяжелую генерацию документов (PDF, DOCX).
    * Отправляет результат через Webhook (Callback).
    * Обновляет статусы в ClickHouse.
3.  **`redis` (Порт 6379)** — Очередь задач.
4.  **`clickhouse` (Порт 8123)** — Хранение данных пользователей и логов генерации.

---

## Структура проекта

```text
.
├── app/                    # Основной API (User API)
│   ├── api/                # Эндпоинты (Users, Documents)
│   ├── repository.py       # Работа с ClickHouse (SQL)
│   ├── services.py         # Бизнес-логика
│   └── ...
├── generator_service/      # Микросервис генератора
│   ├── generator/
│   │   ├── worker.py       # Логика обработки задач из Redis
│   │   └── core.py         # Генерация документов
│   └── ...
├── tests/                  # Интеграционные тесты (pytest)
├── .github/workflows/      # CI Pipeline (Flake8 + Tests)
├── docker-compose.yml      # Оркестрация всех сервисов
├── Dockerfile              # Сборка основного API
└── pyproject.toml          # Зависимости основного API